<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ËÅäÂ§©</title>
    
    <!-- CSSÊñá‰ª∂ÂºïÂÖ• -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/chat/chat-common.css">
    <link rel="stylesheet" href="css/chat/modal.css">
    <link rel="stylesheet" href="css/chat/chat-list.css">
    <link rel="stylesheet" href="css/chat/friend-list.css">
    <link rel="stylesheet" href="css/chat/discover.css">
    <link rel="stylesheet" href="css/chat/profile.css">
    <link rel="stylesheet" href="css/chat/chat-interface.css">  <!-- ‚Üê Âä†ËøôË°å -->
</head>
<body>
    
    <!-- ËÅäÂ§©APPÂÆπÂô® -->
    <div class="chat-app-container">
        
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <div class="top-bar">
            <button class="back-btn" id="backBtn">
                <img src="assets/icons/chat/back.png" alt="ËøîÂõû">
            </button>
            <h1 class="page-title" id="pageTitle">ËÅäÂ§©</h1>
            <div class="top-right-btns" id="topRightBtns">
                <!-- ËÅäÂ§©ÂàóË°®ÁöÑÊåâÈíÆÔºàÈªòËÆ§ÊòæÁ§∫Ôºâ -->
                <button class="search-btn page-btn chat-list-btn" id="searchChatBtn" title="ÊêúÁ¥¢ËÅäÂ§©ËÆ∞ÂΩï">
                    <img src="assets/icons/chat/search-chat.png" alt="ÊêúÁ¥¢">
                </button>
                <button class="add-chat-btn page-btn chat-list-btn" id="addChatBtn" title="ÂàõÂª∫ËÅäÂ§©Ê°Ü">
                    <img src="assets/icons/chat/add-chat.png" alt="ÂàõÂª∫ËÅäÂ§©">
                </button>
                
                <!-- Â•ΩÂèãÂàóË°®ÁöÑÊåâÈíÆÔºàÈªòËÆ§ÈöêËóèÔºâ -->
                <button class="manage-group-btn page-btn friend-list-btn" id="manageGroupBtn" title="ÁÆ°ÁêÜÂàÜÁªÑ" style="display: none;">
                    <img src="assets/icons/chat/manage-group.png" alt="ÁÆ°ÁêÜÂàÜÁªÑ">
                </button>
                <button class="add-friend-btn page-btn friend-list-btn" id="addFriendBtn" title="Ê∑ªÂä†Â•ΩÂèã" style="display: none;">
                    <img src="assets/icons/chat/add-friend.png" alt="Ê∑ªÂä†Â•ΩÂèã">
                </button>
            </div>
        </div>

        <!-- È°µÈù¢ÂÆπÂô® -->
        <div class="pages-container">
            
            <!-- ËÅäÂ§©ÂàóË°®È°µ -->
            <div class="chat-page active" id="chatListPage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">üí¨</div>
                        <div class="empty-text">ÊöÇÊó†ËÅäÂ§©</div>
                    </div>
                </div>
            </div>
            
            <!-- Â•ΩÂèãÂàóË°®È°µ -->
            <div class="chat-page" id="friendListPage">
                <div class="page-content">
                    <!-- Â•ΩÂèãÂàóË°®ÂÆπÂô® -->
                    <div id="friendListContainer"></div>
                    
                    <!-- Á©∫Áä∂ÊÄÅÂç†‰ΩçÔºàÈªòËÆ§ÈöêËóèÔºâ -->
                    <div class="empty-placeholder" id="friendEmptyPlaceholder" style="display: none;">
                        <div class="empty-icon">üë•</div>
                        <div class="empty-text">ÊöÇÊó†Â•ΩÂèã</div>
                    </div>
                </div>
            </div>
            
            <!-- ÂèëÁé∞È°µ -->
            <div class="chat-page" id="discoverPage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">üîç</div>
                        <div class="empty-text">ÂèëÁé∞Êõ¥Â§ö</div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∏™‰∫∫ËÆæÁΩÆÈ°µ -->
            <div class="chat-page" id="profilePage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">‚öôÔ∏è</div>
                        <div class="empty-text">‰∏™‰∫∫ËÆæÁΩÆ</div>
                    </div>
                </div>
            </div>
            
            <!-- ==================== ËÅäÂ§©ÁïåÈù¢È°µ ==================== -->
            <div class="chat-page" id="chatInterfacePage">
                <!-- ËÅäÂ§©ÁïåÈù¢È¢òÂ§¥ -->
                <div class="chat-interface-header">
                    <button class="chat-back-btn" id="chatBackBtn">‚Üê</button>
                    <div class="chat-friend-name" id="chatFriendName">
                        <span>Âä†ËΩΩ‰∏≠...</span>
                    </div>
                    <button class="offline-toggle" id="offlineToggle" title="Á∫ø‰∏ãÊ®°Âºè">üî¥</button>
                    <button class="chat-settings-btn" id="chatSettingsBtn" title="ËÅäÂ§©ËÆæÁΩÆ">‚öôÔ∏è</button>
                </div>

                <!-- TokenÁªüËÆ° -->
                <div class="token-stats" id="tokenStats">
                    <div class="token-display" id="tokenDisplay">
                        <span>Token: 0</span>
                        <span class="expand-icon">‚ñº</span>
                    </div>
                    <div class="token-details" id="tokenDetails" style="display: none;">
                        <div class="token-item">
                            <span>‰∏ñÁïå‰π¶:</span>
                            <span id="tokenWorldbook">0</span>
                        </div>
                        <div class="token-item">
                            <span>‰∫∫ËÆæ:</span>
                            <span id="tokenPersona">0</span>
                        </div>
                        <div class="token-item">
                            <span>ËæìÂÖ•:</span>
                            <span id="tokenInput">0</span>
                        </div>
                        <div class="token-item">
                            <span>ËæìÂá∫:</span>
                            <span id="tokenOutput">0</span>
                        </div>
                        <div class="token-divider"></div>
                        <div class="token-item token-total">
                            <span>ÂÆûÈôÖÊ∂àËÄó:</span>
                            <span id="tokenTotal">0</span>
                        </div>
                    </div>
                </div>

                <!-- Ê∂àÊÅØÂå∫Âüü -->
                <div class="messages-container" id="messagesContainer">
                    <!-- AIÊ≠£Âú®ËæìÂÖ•ÊèêÁ§∫ -->
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        Á™ÅÁ†¥Ê¨°ÂÖÉÈÅáËßÅ‰Ω†‚Ä¶
                    </div>
                    
                    <!-- Ê∂àÊÅØÂàóË°® -->
                    <div class="messages-list" id="messagesList">
                        <!-- Ê∂àÊÅØ‰ºöÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>

                <!-- Â∫ïÈÉ®ËæìÂÖ•Ê†è -->
                <div class="input-bar" id="inputBar">
                    <!-- ËèúÂçïÊåâÈíÆ -->
                    <button class="menu-btn" id="menuBtn">‚ò∞</button>
                    
                    <!-- ËæìÂÖ•Ê°Ü -->
                    <div class="input-wrapper" id="inputWrapper">
                        <textarea 
                            class="input-field" 
                            id="inputField" 
                            rows="1" 
                            placeholder="ËØ∑ÂÅúÁïô‰∫éÊàëÊâãÂøÉ‚Ä¶"
                        ></textarea>
                        <button class="expand-btn" id="expandBtn" title="Â±ïÂºÄ">‚¨Ü</button>
                    </div>
                    
                    <!-- AIÂèëÈÄÅÊåâÈíÆ -->
                    <button class="ai-send-btn" id="aiSendBtn" title="AIÂèëÈÄÅ">ü§ñ</button>
                    
                    <!-- Áî®Êà∑ÂèëÈÄÅÊåâÈíÆ -->
                    <button class="user-send-btn" id="userSendBtn" title="ÂèëÈÄÅ">üì§</button>
                </div>

                <!-- ËèúÂçïÈù¢ÊùøÔºàÂ±ïÂºÄÔºâ -->
                <div class="menu-panel" id="menuPanel" style="display: none;">
                    <div class="menu-row">
                        <!-- ÁúüÂÆûÂäüËÉΩ -->
                        <button class="menu-item" id="menuResay" title="ÈáçËØ¥">
                            <span class="menu-icon">üîÑ</span>
                            <span class="menu-label">ÈáçËØ¥</span>
                        </button>
                        <button class="menu-item" id="menuEmoji" title="Ë°®ÊÉÖ">
                            <span class="menu-icon">üòä</span>
                            <span class="menu-label">Ë°®ÊÉÖ</span>
                        </button>
                        <button class="menu-item" id="menuImage" title="ÂõæÁâá">
                            <span class="menu-icon">üì∑</span>
                            <span class="menu-label">ÂõæÁâá</span>
                        </button>
                        <button class="menu-item" id="menuVideo" title="ËßÜÈ¢ë">
                            <span class="menu-icon">üé•</span>
                            <span class="menu-label">ËßÜÈ¢ë</span>
                        </button>
                    </div>
                    <div class="menu-row">
                        <button class="menu-item" id="menuVoice" title="ËØ≠Èü≥">
                            <span class="menu-icon">üé§</span>
                            <span class="menu-label">ËØ≠Èü≥</span>
                        </button>
                        <button class="menu-item" id="menuFile" title="Êñá‰ª∂">
                            <span class="menu-icon">üìÅ</span>
                            <span class="menu-label">Êñá‰ª∂</span>
                        </button>
                        <!-- Âç†‰ΩçÁ¨¶ -->
                        <button class="menu-item menu-placeholder" id="menuListenTogether" title="‰∏ÄËµ∑Âê¨ÔºàÂºÄÂèë‰∏≠Ôºâ">
                            <span class="menu-icon">üéß</span>
                            <span class="menu-label">‰∏ÄËµ∑Âê¨</span>
                        </button>
                        <button class="menu-item menu-placeholder" id="menuWatchTogether" title="‰∏ÄËµ∑ÁúãÔºàÂºÄÂèë‰∏≠Ôºâ">
                            <span class="menu-icon">üì∫</span>
                            <span class="menu-label">‰∏ÄËµ∑Áúã</span>
                        </button>
                    </div>
                </div>

                <!-- Áä∂ÊÄÅÂºπÁ™óÔºàÁÇπÂáªÂ§áÊ≥®ÂêçÔºâ -->
                <div class="status-modal" id="statusModal" style="display: none;">
                    <div class="status-content">
                        <div class="status-item">
                            <span class="status-label">Ë£ÖÊâÆ:</span>
                            <span class="status-value" id="statusOutfit">Âä†ËΩΩ‰∏≠...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Âä®‰Ωú:</span>
                            <span class="status-value" id="statusAction">Âä†ËΩΩ‰∏≠...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ÂøÉÂ£∞:</span>
                            <span class="status-value" id="statusMood">Âä†ËΩΩ‰∏≠...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">‰ΩçÁΩÆ:</span>
                            <span class="status-value" id="statusLocation">Âä†ËΩΩ‰∏≠...</span>
                        </div>
                        <div class="status-divider"></div>
                        <button class="status-detail-btn" id="statusDetailBtn">Êü•ÁúãËØ¶ÁªÜËµÑÊñô</button>
                    </div>
                </div>
            </div>
            <!-- ==================== ËÅäÂ§©ÁïåÈù¢È°µÁªìÊùü ==================== -->
            
        </div>
        <!-- ‚Üê pages-container ÁªìÊùü -->

        <!-- Â∫ïÈÉ®ÂØºËà™Ê†è -->
        <div class="bottom-nav">
            <button class="nav-btn active" data-page="chatListPage">
                <img src="assets/icons/chat/nav-chat.png" alt="ËÅäÂ§©" class="nav-icon-img">
                <div class="nav-label">ËÅäÂ§©</div>
            </button>
            <button class="nav-btn" data-page="friendListPage">
                <img src="assets/icons/chat/nav-friend.png" alt="Â•ΩÂèã" class="nav-icon-img">
                <div class="nav-label">Â•ΩÂèã</div>
            </button>
            <button class="nav-btn" data-page="discoverPage">
                <img src="assets/icons/chat/nav-discover.png" alt="ÂèëÁé∞" class="nav-icon-img">
                <div class="nav-label">ÂèëÁé∞</div>
            </button>
            <button class="nav-btn" data-page="profilePage">
                <img src="assets/icons/chat/nav-profile.png" alt="Êàë" class="nav-icon-img">
                <div class="nav-label">Êàë</div>
            </button>
        </div>
        
    </div>
    <!-- ‚Üê ËÅäÂ§©APPÂÆπÂô®Âà∞ËøôÈáåÁªìÊùü -->
    
    <!-- ==================== ‰∫∫ËÆæÁºñËæëÂºπÁ™ó ==================== -->
    <div class="modal-overlay" id="editFriendModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">ÁºñËæëÂ•ΩÂèã</h2>
                <button class="modal-close-btn" id="closeEditModal">√ó</button>
            </div>
            
            <div class="modal-content">
                <!-- Â§¥ÂÉèÂå∫Âüü -->
                <div class="edit-section">
                    <label class="edit-label">Â§¥ÂÉè</label>
                    <div class="avatar-upload-area" id="avatarUploadArea">
                        <div class="avatar-preview" id="avatarPreview">
                            <span id="avatarPlaceholder">Êµã</span>
                        </div>
                        <div class="avatar-upload-hint">ÁÇπÂáª‰∏ä‰º†Â§¥ÂÉè</div>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                </div>
                
                <!-- Â§¥ÂÉèËØÜÂà´ÂºÄÂÖ≥ -->
                <div class="edit-section switch-section">
                    <label class="edit-label">Â§¥ÂÉèËØÜÂà´</label>
                    <label class="switch">
                        <input type="checkbox" id="avatarRecognitionSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- ÁúüÂÆûÂßìÂêç -->
                <div class="edit-section">
                    <label class="edit-label">ÁúüÂÆûÂßìÂêç</label>
                    <input type="text" class="edit-input" id="editRealName" placeholder="ÈÄâÂ°´">
                </div>
                
                <!-- ÁΩëÂêç -->
                <div class="edit-section">
                    <label class="edit-label">ÁΩëÂêç *</label>
                    <input type="text" class="edit-input" id="editName" placeholder="ÂøÖÂ°´" required>
                </div>
                
                <!-- Â§áÊ≥® -->
                <div class="edit-section">
                    <label class="edit-label">Â§áÊ≥®</label>
                    <input type="text" class="edit-input" id="editNickname" placeholder="ÈÄâÂ°´">
                </div>
                
                <!-- ‰∏™ÊÄßÁ≠æÂêç -->
                <div class="edit-section">
                    <label class="edit-label">‰∏™ÊÄßÁ≠æÂêç</label>
                    <input type="text" class="edit-input" id="editSignature" placeholder="ÈÄâÂ°´">
                </div>
                
                <!-- ‰∫∫ËÆæ -->
                <div class="edit-section">
                    <label class="edit-label">‰∫∫ËÆæÔºàPersonaÔºâ</label>
                    <textarea class="edit-textarea" id="editPersona" rows="8" placeholder="Âú®ËøôÈáåÈöèÊÑèÁºñÂÜôËßíËâ≤‰∫∫ËÆæ...&#10;&#10;‰Ω†ÂèØ‰ª•ÂÜôÔºö&#10;- ÁÆÄÂçïÁöÑ‰∏ÄÂè•ËØù&#10;- ÊàñËÄÖËØ¶ÁªÜÁöÑÊÄßÊ†º„ÄÅËÉåÊôØ„ÄÅÂÖ≥Á≥ªÁ≠â&#10;&#10;ÂèÇËÄÉSillyTavernÁöÑ‰∫∫ËÆæÊ°Ü"></textarea>
                </div>
                
                <!-- Êãç‰∏ÄÊãç -->
                <div class="edit-section">
                    <label class="edit-label">Êãç‰∏ÄÊãç</label>
                    <input type="text" class="edit-input" id="editPoke" placeholder="‰æãÂ¶ÇÔºöÊà≥‰∫ÜÊà≥‰Ω†ÁöÑÂ§¥">
                </div>
                
                <!-- ‰øùÂ≠òÊåâÈíÆ -->
                <button class="save-btn" id="saveFriendBtn">‰øùÂ≠ò</button>
                
                <!-- Âç±Èô©Êìç‰ΩúÂå∫ -->
                <div class="danger-zone">
                    <div class="danger-zone-title">Âç±Èô©Êìç‰Ωú</div>
                    <button class="delete-btn" id="deleteFriendBtn">Âà†Èô§Â•ΩÂèã</button>
                </div>
            </div>
        </div>
    </div>
    
       <!-- ==================== Ê∑ªÂä†Â•ΩÂèãÈÄâÊã©ÂºπÁ™ó ==================== -->
    <div class="modal-overlay" id="addFriendChoiceModal" style="display: none;">
        <div class="modal-container small">
            <div class="modal-header">
                <h2 class="modal-title">Ê∑ªÂä†Â•ΩÂèã</h2>
                <button class="modal-close-btn" id="closeAddChoiceModal">√ó</button>
            </div>
            
            <div class="modal-content">
                <button class="choice-btn" id="newFriendBtn">
                    <span class="choice-icon">üìù</span>
                    <span class="choice-text">Êñ∞Âª∫Â•ΩÂèã</span>
                </button>
                
                <button class="choice-btn" id="addByCodeBtn">
                    <span class="choice-icon">üî¢</span>
                    <span class="choice-text">ÈÄöËøáÁºñÁ†ÅÊ∑ªÂä†</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- ==================== Êñ∞Âª∫Â•ΩÂèãÂºπÁ™ó ==================== -->
    <div class="modal-overlay" id="newFriendModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">Êñ∞Âª∫Â•ΩÂèã</h2>
                <button class="modal-close-btn" id="closeNewFriendModal">√ó</button>
            </div>
            
            <div class="modal-content">
                <!-- ÁΩëÂêç -->
                <div class="edit-section">
                    <label class="edit-label">ÁΩëÂêç *</label>
                    <input type="text" class="edit-input" id="newFriendName" placeholder="ÂøÖÂ°´" required>
                </div>
                
                <!-- Â§áÊ≥® -->
                <div class="edit-section">
                    <label class="edit-label">Â§áÊ≥®</label>
                    <input type="text" class="edit-input" id="newFriendNickname" placeholder="ÈÄâÂ°´">
                </div>
                
                <!-- ‰∏™ÊÄßÁ≠æÂêç -->
                <div class="edit-section">
                    <label class="edit-label">‰∏™ÊÄßÁ≠æÂêç</label>
                    <input type="text" class="edit-input" id="newFriendSignature" placeholder="ÈÄâÂ°´">
                </div>
                
                <!-- ‰∫∫ËÆæ -->
                <div class="edit-section">
                    <label class="edit-label">‰∫∫ËÆæÔºàPersonaÔºâ</label>
                    <textarea class="edit-textarea" id="newFriendPersona" rows="6" placeholder="Âú®ËøôÈáåÈöèÊÑèÁºñÂÜôËßíËâ≤‰∫∫ËÆæ..."></textarea>
                </div>
                
                <!-- Êãç‰∏ÄÊãç -->
                <div class="edit-section">
                    <label class="edit-label">Êãç‰∏ÄÊãç</label>
                    <input type="text" class="edit-input" id="newFriendPoke" placeholder="‰æãÂ¶ÇÔºöÊà≥‰∫ÜÊà≥‰Ω†ÁöÑÂ§¥">
                </div>
                
                <!-- ÂàõÂª∫ÊåâÈíÆ -->
                <button class="save-btn" id="createFriendBtn">ÂàõÂª∫</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== ÈÄöËøáÁºñÁ†ÅÊ∑ªÂä†ÂºπÁ™ó ==================== -->
    <div class="modal-overlay" id="addByCodeModal" style="display: none;">
        <div class="modal-container small">
            <div class="modal-header">
                <h2 class="modal-title">ÈÄöËøáÁºñÁ†ÅÊ∑ªÂä†</h2>
                <button class="modal-close-btn" id="closeAddByCodeModal">√ó</button>
            </div>
            
            <div class="modal-content">
                <div class="edit-section">
                    <label class="edit-label">ËæìÂÖ•Â•ΩÂèãÁºñÁ†Å</label>
                    <input type="text" class="edit-input" id="friendCodeInput" placeholder="‰æãÂ¶ÇÔºöTEST_2k25_ABC#">
                    <div class="code-hint">ÁºñÁ†ÅÊ†ºÂºèÔºöXXX_Âπ¥‰ªΩ_ÈöèÊú∫#</div>
                </div>
                
                <!-- Ê∑ªÂä†ÊåâÈíÆ -->
                <button class="save-btn" id="addByCodeConfirmBtn">Ê∑ªÂä†</button>
            </div>
        </div>
    </div>
    
    <!-- JavaScriptÊñá‰ª∂ÂºïÂÖ• -->
    <script src="js/chat/storage.js"></script>
    <script src="js/chat/chat-interface.js"></script>  <!-- ‚Üê Âä†ËøôË°åÔºåÊ≥®ÊÑèÈ°∫Â∫èÔºÅ -->
    <script src="js/chat/chat-app.js"></script>
    
</body>
</html>