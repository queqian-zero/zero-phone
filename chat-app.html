<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>聊天</title>
    
    <!-- CSS文件引入 -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/chat/chat-common.css">
    <link rel="stylesheet" href="css/chat/modal.css">
    <link rel="stylesheet" href="css/chat/chat-list.css">
    <link rel="stylesheet" href="css/chat/friend-list.css">
    <link rel="stylesheet" href="css/chat/discover.css">
    <link rel="stylesheet" href="css/chat/profile.css">
    <link rel="stylesheet" href="css/chat/chat-interface.css">
    <link rel="stylesheet" href="css/chat/chat-settings.css">  <!-- ← 新增这行 -->
</head>
<body>
    
    <!-- 聊天APP容器 -->
    <div class="chat-app-container">
        
        <!-- 顶部导航栏 -->
        <div class="top-bar">
            <button class="back-btn" id="backBtn">
                <img src="assets/icons/chat/back.png" alt="返回">
            </button>
            <h1 class="page-title" id="pageTitle">聊天</h1>
            <div class="top-right-btns" id="topRightBtns">
                <!-- 聊天列表的按钮（默认显示） -->
                <button class="search-btn page-btn chat-list-btn" id="searchChatBtn" title="搜索聊天记录">
                    <img src="assets/icons/chat/search-chat.png" alt="搜索">
                </button>
                <button class="add-chat-btn page-btn chat-list-btn" id="addChatBtn" title="创建聊天框">
                    <img src="assets/icons/chat/add-chat.png" alt="创建聊天">
                </button>
                
                <!-- 好友列表的按钮（默认隐藏） -->
                <button class="manage-group-btn page-btn friend-list-btn" id="manageGroupBtn" title="管理分组" style="display: none;">
                    <img src="assets/icons/chat/manage-group.png" alt="管理分组">
                </button>
                <button class="add-friend-btn page-btn friend-list-btn" id="addFriendBtn" title="添加好友" style="display: none;">
                    <img src="assets/icons/chat/add-friend.png" alt="添加好友">
                </button>
            </div>
        </div>

        <!-- 页面容器 -->
        <div class="pages-container">
            
            <!-- 聊天列表页 -->
            <div class="chat-page active" id="chatListPage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">💬</div>
                        <div class="empty-text">暂无聊天</div>
                    </div>
                </div>
            </div>
            
            <!-- 好友列表页 -->
            <div class="chat-page" id="friendListPage">
                <div class="page-content">
                    <!-- 好友列表容器 -->
                    <div id="friendListContainer"></div>
                    
                    <!-- 空状态占位（默认隐藏） -->
                    <div class="empty-placeholder" id="friendEmptyPlaceholder" style="display: none;">
                        <div class="empty-icon">👥</div>
                        <div class="empty-text">暂无好友</div>
                    </div>
                </div>
            </div>
            
            <!-- 发现页 -->
            <div class="chat-page" id="discoverPage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">🔍</div>
                        <div class="empty-text">发现更多</div>
                    </div>
                </div>
            </div>
            
            <!-- 个人设置页 -->
            <div class="chat-page" id="profilePage">
                <div class="page-content">
                    <div class="empty-placeholder">
                        <div class="empty-icon">⚙️</div>
                        <div class="empty-text">个人设置</div>
                    </div>
                </div>
            </div>
            
            <!-- ==================== 聊天界面页 ==================== -->
<div class="chat-page" id="chatInterfacePage">
    <!-- 聊天界面题头 -->
    <div class="chat-interface-header">
        <button class="chat-back-btn" id="chatBackBtn">←</button>
        <div class="chat-friend-name" id="chatFriendName">
            <span>加载中...</span>
        </div>
        <button class="offline-toggle" id="offlineToggle" title="线下模式">🔴</button>
        <button class="chat-settings-btn" id="chatSettingsBtn" title="聊天设置">⚙️</button>
    </div>

    <!-- Token统计 -->
    <div class="token-stats" id="tokenStats">
        <div class="token-display" id="tokenDisplay">
            <span>Token: 0</span>
            <span class="expand-icon">▼</span>
        </div>
        <div class="token-details" id="tokenDetails" style="display: none;">
            <div class="token-item">
                <span>世界书:</span>
                <span id="tokenWorldbook">0</span>
            </div>
            <div class="token-item">
                <span>人设:</span>
                <span id="tokenPersona">0</span>
            </div>
            <div class="token-item">
                <span>输入:</span>
                <span id="tokenInput">0</span>
            </div>
            <div class="token-item">
                <span>输出:</span>
                <span id="tokenOutput">0</span>
            </div>
            <div class="token-divider"></div>
            <div class="token-item token-total">
                <span>实际消耗:</span>
                <span id="tokenTotal">0</span>
            </div>
        </div>
    </div>

    <!-- 消息区域 -->
    <div class="messages-container" id="messagesContainer">
        <!-- 消息列表 -->
        <div class="messages-list" id="messagesList">
            <!-- 消息会动态生成 -->
        </div>
    </div>

    <!-- 底部输入栏 -->
    <div class="input-bar" id="inputBar">
        <!-- 展开状态的输入框（默认隐藏） -->
        <div class="input-wrapper" id="inputWrapper">
            <textarea 
                class="input-field" 
                id="inputField" 
                placeholder="请停留于我手心…"
            ></textarea>
            <button class="expand-btn" id="expandBtn" title="收起">⬇</button>
        </div>
        
        <!-- 底部按钮行 -->
        <div class="input-bar-bottom">
            <button class="menu-btn" id="menuBtn">☰</button>
            <textarea 
                id="inputFieldInline" 
                rows="1" 
                placeholder="请停留于我手心…"
            ></textarea>
            <button class="inline-expand-btn" id="inlineExpandBtn" title="展开">⬆</button>
            <button class="ai-send-btn" id="aiSendBtn" title="AI发送">🤖</button>
            <button class="user-send-btn" id="userSendBtn" title="发送">📤</button>
        </div>
    </div>

    <!-- 菜单面板（展开） -->
    <div class="menu-panel" id="menuPanel" style="display: none;">
        <div class="menu-row">
            <button class="menu-item" id="menuResay" title="重说">
                <span class="menu-icon">🔄</span>
                <span class="menu-label">重说</span>
            </button>
            <button class="menu-item" id="menuEmoji" title="表情">
                <span class="menu-icon">😊</span>
                <span class="menu-label">表情</span>
            </button>
            <button class="menu-item" id="menuImage" title="图片">
                <span class="menu-icon">📷</span>
                <span class="menu-label">图片</span>
            </button>
            <button class="menu-item" id="menuVideo" title="视频">
                <span class="menu-icon">🎥</span>
                <span class="menu-label">视频</span>
            </button>
        </div>
        <div class="menu-row">
            <button class="menu-item" id="menuVoice" title="语音">
                <span class="menu-icon">🎤</span>
                <span class="menu-label">语音</span>
            </button>
            <button class="menu-item" id="menuFile" title="文件">
                <span class="menu-icon">📁</span>
                <span class="menu-label">文件</span>
            </button>
            <button class="menu-item menu-placeholder" id="menuListenTogether" title="一起听（开发中）">
                <span class="menu-icon">🎧</span>
                <span class="menu-label">一起听</span>
            </button>
            <button class="menu-item menu-placeholder" id="menuWatchTogether" title="一起看（开发中）">
                <span class="menu-icon">📺</span>
                <span class="menu-label">一起看</span>
            </button>
        </div>
    </div>

    <!-- 状态弹窗（点击备注名） -->
    <div class="status-modal" id="statusModal" style="display: none;">
        <div class="status-content">
            <div class="status-item">
                <span class="status-label">装扮:</span>
                <span class="status-value" id="statusOutfit">加载中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">动作:</span>
                <span class="status-value" id="statusAction">加载中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">心声:</span>
                <span class="status-value" id="statusMood">加载中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">位置:</span>
                <span class="status-value" id="statusLocation">加载中...</span>
            </div>
            <div class="status-divider"></div>
            <button class="status-detail-btn" id="statusDetailBtn">查看详细资料</button>
        </div>
    </div>
</div>
<!-- ==================== 聊天界面页结束 ==================== -->
            
            <!-- ==================== 聊天设置页面 ==================== -->
<div class="chat-settings-page" id="chatSettingsPage" style="display: none;">
    <!-- 设置页面题头 -->
    <div class="settings-header">
        <button class="settings-back-btn" id="settingsBackBtn">←</button>
        <h2 class="settings-title">聊天设置</h2>
        <button class="settings-done-btn" id="settingsDoneBtn">完成</button>
    </div>

    <!-- 设置内容区域 -->
    <div class="settings-content" id="settingsContent">
        
        <!-- ========== 基础设置模块 ========== -->
        <div class="settings-section">
            <h3 class="section-title">基础设置</h3>
            
            <!-- AI识别图片 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">AI识别图片</span>
                    <span class="setting-desc">开启后AI可以识别图片内容</span>
                </div>
                <label class="setting-switch">
                    <input type="checkbox" id="settingAiRecognizeImage" checked>
                    <span class="switch-slider"></span>
                </label>
            </div>
            
            <!-- 搜索聊天记录 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">搜索聊天记录</span>
                </div>
                <button class="setting-action-btn" id="settingSearchChat">
                    <span>🔍</span>
                </button>
            </div>
            
            <!-- 聊天置顶 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">聊天置顶</span>
                    <span class="setting-desc">置顶后该聊天将显示在列表顶部</span>
                </div>
                <label class="setting-switch">
                    <input type="checkbox" id="settingChatPin">
                    <span class="switch-slider"></span>
                </label>
            </div>
            
            <!-- 拍一拍 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">拍一拍</span>
                    <span class="setting-value" id="settingPokeValue">戳了戳你</span>
                </div>
            </div>
        </div>
        
        <!-- ========== 进阶设置模块 ========== -->
<div class="settings-section">
    <h3 class="section-title">进阶设置</h3>
    
    <!-- 隐藏Token统计 -->
<div class="setting-item">
    <div class="setting-info">
        <span class="setting-label">隐藏Token统计</span>
        <span class="setting-desc">关闭聊天界面的Token显示</span>
    </div>
    <label class="setting-switch">
        <input type="checkbox" id="settingHideToken">
        <span class="switch-slider"></span>
    </label>
</div>

<!-- ========== 新增：上下文记忆条数 ========== -->
<div class="setting-item">
    <div class="setting-info">
        <span class="setting-label">上下文记忆条数</span>
        <span class="setting-desc">AI每次能看到多少条历史消息</span>
    </div>
    <input type="number" 
           id="settingContextMessages" 
           min="1" 
           max="100" 
           value="20"
           style="width: 60px; padding: 6px 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: rgba(255,255,255,0.9); text-align: center; font-size: 14px;">
</div>

<div style="padding: 10px 16px; margin: 0 16px 16px 16px; background: rgba(139,0,0,0.1); border-left: 3px solid rgba(139,0,0,0.5); border-radius: 4px; font-size: 12px; color: rgba(255,255,255,0.7); line-height: 1.6;">
    💡 提示：<br>
    • 条数越多，AI记忆越完整<br>
    • 但会消耗更多Token，响应可能更慢<br>
    • 推荐设置：10-30条
</div>
<!-- ========== 新增结束 ========== -->

<!-- 记忆模块入口 -->
<div class="setting-item" id="settingMemoryModule" style="cursor: pointer;">
    <div class="setting-info">
        <span class="setting-label">记忆模块</span>
        <span class="setting-desc">自动总结、手动总结、聊天记录同步</span>
    </div>
    <span style="color: rgba(255,255,255,0.5); font-size: 16px;">›</span>
</div>
    
    <!-- 群聊消息同步 -->
    <div class="setting-item disabled">
        <div class="setting-info">
            <span class="setting-label">群聊消息同步</span>
            <span class="setting-desc">让AI感知群聊中的其他消息</span>
        </div>
        <label class="setting-switch">
            <input type="checkbox" disabled>
            <span class="switch-slider"></span>
        </label>
        <span class="setting-badge">待开发</span>
    </div>
            
            <!-- AI自动发信息 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">AI自动发信息</span>
                    <span class="setting-desc">设置AI主动发消息的频率</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- AI主动写日记 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">AI主动写日记</span>
                    <span class="setting-desc">每天定时自动写日记</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- AI主动发朋友圈 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">AI主动发朋友圈</span>
                    <span class="setting-desc">设置发朋友圈的频率</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 可见消息条数 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">可见消息条数</span>
                    <span class="setting-desc">AI能看到的上下文消息数量</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 破次元时间感知 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">破次元时间感知</span>
                    <span class="setting-desc">让AI感知现实世界的时间</span>
                </div>
                <label class="setting-switch">
                    <input type="checkbox" disabled checked>
                    <span class="switch-slider"></span>
                </label>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 关联世界书 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">关联世界书</span>
                    <span class="setting-desc">为角色添加世界观设定</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
        </div>
        
        <!-- ========== 美化模块 ========== -->
        <div class="settings-section">
            <h3 class="section-title">美化模块</h3>
            
            <!-- 聊天气泡CSS -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">聊天气泡美化</span>
                    <span class="setting-desc">自定义气泡样式、圆角、颜色</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 头像框 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">头像框</span>
                    <span class="setting-desc">圆形/方形，自定义头像框</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 聊天壁纸 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">聊天壁纸</span>
                    <span class="setting-desc">上传自定义聊天背景</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
        </div>
        
        <!-- ========== 亲密关系模块 ========== -->
        <div class="settings-section">
            <h3 class="section-title">亲密关系</h3>
            
            <!-- 续火花系统 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">续火花系统</span>
                    <span class="setting-desc">设置火花开始时间和熄灭时长</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 亲密关系绑定 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">亲密关系绑定</span>
                    <span class="setting-desc">情侣、基友等亲密关系</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 语音与视频 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">语音与视频</span>
                    <span class="setting-desc">设置AI语音ID</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
            
            <!-- 消息提醒 -->
            <div class="setting-item disabled">
                <div class="setting-info">
                    <span class="setting-label">消息提醒</span>
                    <span class="setting-desc">来电铃声、消息提示音</span>
                </div>
                <span class="setting-badge">待开发</span>
            </div>
        </div>
        
        <!-- ========== 数据管理模块 ========== -->
        <div class="settings-section">
            <h3 class="section-title">数据管理</h3>
            
            <!-- 导入数据 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">导入数据</span>
                    <span class="setting-desc">导入聊天记录或完整数据</span>
                </div>
                <button class="setting-action-btn" id="settingImportData">
                    <span>📥</span>
                </button>
            </div>
            
            <!-- 导出数据 -->
            <div class="setting-item">
                <div class="setting-info">
                    <span class="setting-label">导出数据</span>
                    <span class="setting-desc">导出聊天记录或完整数据</span>
                </div>
                <button class="setting-action-btn" id="settingExportData">
                    <span>📤</span>
                </button>
            </div>
        </div>
        
    </div>
</div>
<!-- ==================== 聊天设置页面结束 ==================== -->

<!-- ==================== 记忆模块页面 ==================== -->
<div class="memory-module-page" id="memoryModulePage" style="display: none;">
    <!-- 记忆模块题头 -->
    <div class="memory-header">
        <button class="memory-back-btn" id="memoryBackBtn">←</button>
        <h2 class="memory-title">记忆模块</h2>
    </div>

    <!-- 记忆模块内容 -->
    <div class="memory-content">
        
        <!-- 自动总结 -->
        <div class="memory-section">
            <h3 class="memory-section-title">📋 自动总结</h3>
            <div class="memory-section-content">
                <div class="memory-setting-row">
                    <span>启用自动总结</span>
                    <label class="setting-switch">
                        <input type="checkbox" id="memoryAutoSummary" checked>
                        <span class="switch-slider"></span>
                    </label>
                </div>
                <div class="memory-setting-row">
                    <span>总结间隔（条消息）</span>
                    <input type="number" id="memorySummaryInterval" value="20" min="1" max="1000" class="memory-input">
                </div>
            </div>
        </div>
        
        <!-- 手动总结 -->
        <div class="memory-section">
            <h3 class="memory-section-title">📝 手动总结</h3>
            <div class="memory-section-content">
                <button class="memory-action-btn" id="memoryManualSummary">立即生成总结</button>
            </div>
        </div>
        
        <!-- 查看历史总结 -->
        <div class="memory-section">
            <h3 class="memory-section-title">📚 查看历史总结</h3>
            <div class="memory-section-content">
                <button class="memory-nav-btn" id="memoryViewHistory">
                    <span>查看、编辑、删除所有生成的总结</span>
                    <span>›</span>
                </button>
            </div>
        </div>
        
        <!-- 核心记忆 -->
        <div class="memory-section">
            <h3 class="memory-section-title">🧠 核心记忆</h3>
            <div class="memory-section-content">
                <button class="memory-nav-btn disabled">
                    <span>AI自主记录的重要信息</span>
                    <span class="memory-badge">待开发</span>
                </button>
            </div>
        </div>
        
    </div>
</div>
<!-- ==================== 记忆模块页面结束 ==================== -->

<!-- ==================== 历史总结列表页面 ==================== -->
<div class="summary-history-page" id="summaryHistoryPage" style="display: none;">
    <!-- 历史总结题头 -->
    <div class="summary-history-header">
        <button class="summary-history-back-btn" id="summaryHistoryBackBtn">←</button>
        <h2 class="summary-history-title">历史总结</h2>
    </div>

    <!-- 历史总结列表 -->
    <div class="summary-history-content" id="summaryHistoryContent">
        <!-- 总结卡片会动态生成 -->
    </div>
</div>
<!-- ==================== 历史总结列表页面结束 ==================== -->

<!-- ==================== 总结详情页面 ==================== -->
<div class="summary-detail-page" id="summaryDetailPage" style="display: none;">
    <!-- 总结详情题头 -->
    <div class="summary-detail-header">
        <button class="summary-detail-back-btn" id="summaryDetailBackBtn">←</button>
        <h2 class="summary-detail-title" id="summaryDetailTitle">对话总结</h2>
    </div>

    <!-- 总结详情内容 -->
    <div class="summary-detail-content" id="summaryDetailContent">
        <!-- 详细内容会动态生成 -->
    </div>
</div>
<!-- ==================== 总结详情页面结束 ==================== -->

<!-- ==================== 手动总结弹窗 ==================== -->
<div class="manual-summary-modal" id="manualSummaryModal" style="display: none;">
    <div class="manual-summary-overlay" id="manualSummaryOverlay"></div>
    <div class="manual-summary-dialog">
        <div class="manual-summary-header">
            <h3>手动生成总结</h3>
            <button class="manual-summary-close" id="manualSummaryClose">×</button>
        </div>
        <div class="manual-summary-body">
            <div class="manual-summary-info">
                <p>当前共有 <span id="manualTotalMessages">0</span> 条消息</p>
                <p>已总结 <span id="manualSummarizedMessages">0</span> 条，未总结 <span id="manualUnsummarizedMessages">0</span> 条</p>
            </div>
            <div class="manual-summary-options">
                <label class="manual-summary-option">
                    <input type="radio" name="summaryRange" value="recent" checked>
                    <span>最近</span>
                    <input type="number" id="manualRecentCount" value="50" min="1" class="manual-summary-input">
                    <span>条消息</span>
                </label>
                <label class="manual-summary-option">
                    <input type="radio" name="summaryRange" value="range">
                    <span>从第</span>
                    <input type="number" id="manualRangeStart" value="1" min="1" class="manual-summary-input">
                    <span>条到第</span>
                    <input type="number" id="manualRangeEnd" value="20" min="1" class="manual-summary-input">
                    <span>条</span>
                </label>
                <label class="manual-summary-option">
                    <input type="radio" name="summaryRange" value="unsummarized">
                    <span>所有未总结的消息（<span id="manualUnsummarizedCount">0</span> 条）</span>
                </label>
            </div>
        </div>
        <div class="manual-summary-footer">
            <button class="manual-summary-cancel" id="manualSummaryCancel">取消</button>
            <button class="manual-summary-confirm" id="manualSummaryConfirm">生成总结</button>
        </div>
    </div>
</div>
<!-- ==================== 手动总结弹窗结束 ==================== -->

<!-- ==================== 编辑总结弹窗 ==================== -->
<div class="edit-summary-modal" id="editSummaryModal" style="display: none;">
    <div class="edit-summary-overlay" id="editSummaryOverlay"></div>
    <div class="edit-summary-dialog">
        <div class="edit-summary-header">
            <h3>编辑总结</h3>
            <button class="edit-summary-close" id="editSummaryClose">×</button>
        </div>
        <div class="edit-summary-body">
            <div class="edit-summary-field">
                <label>一句话总结：</label>
                <input type="text" id="editSummarySummary" class="edit-summary-input" maxlength="80">
            </div>
            <div class="edit-summary-field">
                <label>详细内容：</label>
                <textarea id="editSummaryContent" class="edit-summary-textarea" rows="15"></textarea>
            </div>
        </div>
        <div class="edit-summary-footer">
            <button class="edit-summary-cancel" id="editSummaryCancel">取消</button>
            <button class="edit-summary-confirm" id="editSummaryConfirm">保存</button>
        </div>
    </div>
</div>
<!-- ==================== 编辑总结弹窗结束 ==================== -->

        </div>
        <!-- ← pages-container 结束 -->

        <!-- 底部导航栏 -->
        <div class="bottom-nav">
            <button class="nav-btn active" data-page="chatListPage">
                <img src="assets/icons/chat/nav-chat.png" alt="聊天" class="nav-icon-img">
                <div class="nav-label">聊天</div>
            </button>
            <button class="nav-btn" data-page="friendListPage">
                <img src="assets/icons/chat/nav-friend.png" alt="好友" class="nav-icon-img">
                <div class="nav-label">好友</div>
            </button>
            <button class="nav-btn" data-page="discoverPage">
                <img src="assets/icons/chat/nav-discover.png" alt="发现" class="nav-icon-img">
                <div class="nav-label">发现</div>
            </button>
            <button class="nav-btn" data-page="profilePage">
                <img src="assets/icons/chat/nav-profile.png" alt="我" class="nav-icon-img">
                <div class="nav-label">我</div>
            </button>
        </div>
        
    </div>
    <!-- ← 聊天APP容器到这里结束 -->
    
    <!-- ==================== 人设编辑弹窗 ==================== -->
    <div class="modal-overlay" id="editFriendModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">编辑好友</h2>
                <button class="modal-close-btn" id="closeEditModal">×</button>
            </div>
            
            <div class="modal-content">
                <!-- 头像区域 -->
                <div class="edit-section">
                    <label class="edit-label">头像</label>
                    <div class="avatar-upload-area" id="avatarUploadArea">
                        <div class="avatar-preview" id="avatarPreview">
                            <span id="avatarPlaceholder">测</span>
                        </div>
                        <div class="avatar-upload-hint">点击上传头像</div>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                </div>
                
                <!-- 头像识别开关 -->
                <div class="edit-section switch-section">
                    <label class="edit-label">头像识别</label>
                    <label class="switch">
                        <input type="checkbox" id="avatarRecognitionSwitch" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <!-- 真实姓名 -->
                <div class="edit-section">
                    <label class="edit-label">真实姓名</label>
                    <input type="text" class="edit-input" id="editRealName" placeholder="选填">
                </div>
                
                <!-- 网名 -->
                <div class="edit-section">
                    <label class="edit-label">网名 *</label>
                    <input type="text" class="edit-input" id="editName" placeholder="必填" required>
                </div>
                
                <!-- 备注 -->
                <div class="edit-section">
                    <label class="edit-label">备注</label>
                    <input type="text" class="edit-input" id="editNickname" placeholder="选填">
                </div>
                
                <!-- 个性签名 -->
                <div class="edit-section">
                    <label class="edit-label">个性签名</label>
                    <input type="text" class="edit-input" id="editSignature" placeholder="选填">
                </div>
                
                <!-- 人设 -->
                <div class="edit-section">
                    <label class="edit-label">人设（Persona）</label>
                    <textarea class="edit-textarea" id="editPersona" rows="8" placeholder="在这里随意编写角色人设...&#10;&#10;你可以写：&#10;- 简单的一句话&#10;- 或者详细的性格、背景、关系等&#10;&#10;参考SillyTavern的人设框"></textarea>
                </div>
                
                <!-- 拍一拍 -->
                <div class="edit-section">
                    <label class="edit-label">拍一拍</label>
                    <input type="text" class="edit-input" id="editPoke" placeholder="例如：戳了戳你的头">
                </div>
                
                <!-- 保存按钮 -->
                <button class="save-btn" id="saveFriendBtn">保存</button>
                
                <!-- 危险操作区 -->
                <div class="danger-zone">
                    <div class="danger-zone-title">危险操作</div>
                    <button class="delete-btn" id="deleteFriendBtn">删除好友</button>
                </div>
            </div>
        </div>
    </div>
    
       <!-- ==================== 添加好友选择弹窗 ==================== -->
    <div class="modal-overlay" id="addFriendChoiceModal" style="display: none;">
        <div class="modal-container small">
            <div class="modal-header">
                <h2 class="modal-title">添加好友</h2>
                <button class="modal-close-btn" id="closeAddChoiceModal">×</button>
            </div>
            
            <div class="modal-content">
                <button class="choice-btn" id="newFriendBtn">
                    <span class="choice-icon">📝</span>
                    <span class="choice-text">新建好友</span>
                </button>
                
                <button class="choice-btn" id="addByCodeBtn">
                    <span class="choice-icon">🔢</span>
                    <span class="choice-text">通过编码添加</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- ==================== 新建好友弹窗 ==================== -->
    <div class="modal-overlay" id="newFriendModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">新建好友</h2>
                <button class="modal-close-btn" id="closeNewFriendModal">×</button>
            </div>
            
            <div class="modal-content">
                <!-- 网名 -->
                <div class="edit-section">
                    <label class="edit-label">网名 *</label>
                    <input type="text" class="edit-input" id="newFriendName" placeholder="必填" required>
                </div>
                
                <!-- 备注 -->
                <div class="edit-section">
                    <label class="edit-label">备注</label>
                    <input type="text" class="edit-input" id="newFriendNickname" placeholder="选填">
                </div>
                
                <!-- 个性签名 -->
                <div class="edit-section">
                    <label class="edit-label">个性签名</label>
                    <input type="text" class="edit-input" id="newFriendSignature" placeholder="选填">
                </div>
                
                <!-- 人设 -->
                <div class="edit-section">
                    <label class="edit-label">人设（Persona）</label>
                    <textarea class="edit-textarea" id="newFriendPersona" rows="6" placeholder="在这里随意编写角色人设..."></textarea>
                </div>
                
                <!-- 拍一拍 -->
                <div class="edit-section">
                    <label class="edit-label">拍一拍</label>
                    <input type="text" class="edit-input" id="newFriendPoke" placeholder="例如：戳了戳你的头">
                </div>
                
                <!-- 创建按钮 -->
                <button class="save-btn" id="createFriendBtn">创建</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== 通过编码添加弹窗 ==================== -->
    <div class="modal-overlay" id="addByCodeModal" style="display: none;">
        <div class="modal-container small">
            <div class="modal-header">
                <h2 class="modal-title">通过编码添加</h2>
                <button class="modal-close-btn" id="closeAddByCodeModal">×</button>
            </div>
            
            <div class="modal-content">
                <div class="edit-section">
                    <label class="edit-label">输入好友编码</label>
                    <input type="text" class="edit-input" id="friendCodeInput" placeholder="例如：TEST_2k25_ABC#">
                    <div class="code-hint">编码格式：XXX_年份_随机#</div>
                </div>
                
                <!-- 添加按钮 -->
                <button class="save-btn" id="addByCodeConfirmBtn">添加</button>
            </div>
        </div>
    </div>
    
    <!-- JavaScript文件引入 -->
<script src="js/chat/storage.js"></script>
<script src="js/core/api-manager.js"></script>  <!-- ← 新增这行！ -->
<script src="js/chat/chat-interface.js"></script>
<script src="js/chat/chat-app.js"></script>
    
</body>
</html>